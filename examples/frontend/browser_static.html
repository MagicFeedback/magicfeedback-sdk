<!doctype html>
<html lang="en">
<!-- HEAD -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>MagicFeedbackAI for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="../assets/cover.css" rel="stylesheet"/>
    <link href="../../public/style.css" rel="stylesheet"/>
</head>

<!-- BODY -->
<body class="text-center">

<div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
    <!-- HEADER -->
    <header class="masthead">
        <div class="inner">
            <nav class="nav nav-masthead justify-content-center">
                <!-- LOGO -->
                <img src="../assets/logo-dark-long.png" alt="MagicFeedbackAI" width="250px" height="auto">
            </nav>
        </div>
    </header>

    <!-- FORM -->
    <main role="main" class="inner cover">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title" id="count-questions"></h6>
            </div>
            <div class="breadcrumb">
            </div>
            <div id="demo_form_div" style="padding: 15px"></div>
        </div>
    </main>
    <div class="loading">
        <div class="spin"></div>
    </div>
</div>
<!-- FOOTER -->
<footer class="mastfoot mt-auto">
    <div class="inner">
        <p>Demo for <a href="https://magicfeedback.io/">MagicFeedback SDK</a>, by <a
                href="https://magicfeedback.io/">@magicfeedbackAI</a>.</p>
    </div>
</footer>
</body>
<!-- JavaScript
================================================== -->
<script src="../../dist/magicfeedback-sdk.browser.js"></script>
<script>
    const countQuestions = document.getElementById('count-questions');
    window.magicfeedback.init({
        debug: true,
        env: "dev"
    });

    // Create the form
    let form = window.magicfeedback.form(
        "f67fe1f0-1367-11ef-9f84-272d884537e8",
        "897d7831736f5bfbc0a64ea699a39265"
    );

    // Generate form
    form.generate(
        "demo_form_div", {
            addButton: true,
            addSuccessScreen: true,
            sendButtonText: "Send my friend",
            beforeSubmitEvent: function () {
                console.log("BEFORE")
                document.querySelector(".loading").style.visibility = "visible";
            },
            afterSubmitEvent: function (response) {
                console.log("AFTER", response);
                document.querySelector(".loading").style.visibility = "hidden";
                countQuestions.innerHTML = `${response.progress} of ${response.total} answered`;
                if (response.error) alert(response.error);

                if (response.answer) {
                    console.log('answers',response.answer);
                    response.answer.forEach((answer) => {
                        if (answer.key === "whichofthefollowingbrandsdoyouknoworhaveeverheardof") {
                            console.log(answer.key, answer.value);
                            // Check if values not contain Suntop or Suncola
                            if(['Suntop', 'Suncola'].every(v => !answer.value.includes(v))) {
                                console.log('finish');
                                form.finish();
                            } else if (answer.value.includes('Suntop')) {
                                console.log('Censure question 5 and 6');
                                form.censureQuestions([
                                    "b2c0f100-1382-11ef-a3d3-c7f03e952305",
                                    "b48ed330-1382-11ef-a3d3-c7f03e952305"
                                ]);
                            } else if (answer.value.includes('Suncola')) {
                                console.log('Censure question 2, 3 and 4');
                                form.censureQuestions([
                                    'ee93fe80-1381-11ef-a3d3-c7f03e952305',
                                    "ad7580d0-1382-11ef-a3d3-c7f03e952305",
                                    "af83a050-1382-11ef-a3d3-c7f03e952305"
                                ]);
                            }
                        }
                    });
                }
            },
            onLoadedEvent: function (response) {
                console.log("LOADED", response);
                document.querySelector(".loading").style.visibility = "hidden";
                countQuestions.innerHTML = `${response.progress} of ${response.total} answered`;
            },
        }
    );

    /*
    magicfeedback.send(
        'f221a0d0-8d34-11ee-81e3-81ea6836afa4',
        '596ce70871d352da65701709248fd687',
        [
            {
                "key": "email",
                "value": [
                    "demo@minimals.cc"
                ]
            },
            {
                "key": "exp",
                "value": [
                    "Good"
                ]
            },
            {
                "key": "hours",
                "value": [
                    "3"
                ]
            },
            {
                "key": "features",
                "value": [
                    "Performance and speed"
                ]
            },
            {
                "key": "features",
                "value": [
                    "User interface and design"
                ]
            },
            {
                "key": "features",
                "value": [
                    "Additional functionality or features"
                ]
            },
            {
                "key": "renew",
                "value": [
                    "Neutral"
                ]
            },
            {
                "key": "started",
                "value": [
                    "2023-12-23"
                ]
            },
            {
                "key": "compare_product",
                "value": [
                    "a lot of use"
                ]
            },
            {
                "key": "name",
                "value": [
                    "Demo a"
                ]
            }
        ]
    )
     */
</script>
</body>
</html>
